# /project-init - ROK Infrastructure Initialization

**CRITICAL**: Run this command FIRST when Claude Code touches ANY project for the first time, regardless of how the project was created (scaffolding tools, Claude Desktop PRD, manual setup, etc.).

## Problem This Solves

Projects created outside ROK workflow (e.g., `create-next-app`, Claude Desktop PRDs, cloned repos) lack:
- `CLAUDE.md` - Project context file
- `claude-progress.txt` - Session handoff log
- `feature_list.json` - Structured requirements
- `init.sh` - Environment startup script
- ROK Brain integration (expertise symlink, decisions.md)

**Without these files, CC sessions lose context between restarts and ROK memory system cannot track the project.**

## Usage

```
/project-init
```

Or with explicit project name:
```
/project-init project:seller-metrics
```

## What This Command Does

### Phase 1: Detection (Automatic)

Claude checks for existing ROK infrastructure:

```bash
# Check for ROK files
ls -la CLAUDE.md claude-progress.txt feature_list.json init.sh 2>/dev/null

# Check for .claude directory
ls -la .claude/ 2>/dev/null

# Check for ROK Brain integration
ls -la ~/.claude/expertise/$(basename $PWD).md 2>/dev/null
```

**If all files exist**: Report status and exit (no action needed)
**If any files missing**: Proceed to Phase 2

### Phase 2: Information Gathering

Claude gathers project context from available sources:

1. **README.md** - Project description, tech stack
2. **package.json / requirements.txt / Cargo.toml** - Dependencies, scripts
3. **Git history** - First commit message, recent commits
4. **Existing status files** - CURRENT_STATUS.md, SESSION_STATUS.md, etc.
5. **Directory structure** - Identify framework (Next.js, FastAPI, etc.)

### Phase 3: File Creation

#### 3.1 Create CLAUDE.md

Template based on detected project type:

```markdown
# [Project Name]

**Project**: [Brief description from README or git]
**Port**: [Detected from package.json or standard]
**Status**: [Active Development / Maintenance / etc.]

---

## Quick Start

```bash
cd [project-path]
[detected start command]
```

## Tech Stack

- **Framework**: [Detected]
- **Database**: [Detected or TBD]
- **UI**: [Detected or TBD]

## Key Directories

```
[Auto-generated from ls]
```

## Development Status

[Extracted from existing status files or initialized as new]

---

## Architecture Decisions

*See `/home/klatt42/obsidian-vaults/rok-brain/01-projects/[project]/decisions.md` for decisions captured via ROK Copilot `/diary` command.*
```

#### 3.2 Create claude-progress.txt

```markdown
# Claude Progress Log - [project-name]

## Latest Session
[YYYY-MM-DD HH:MM] Project Initialized via /project-init
- ROK infrastructure created
- Ready for first development session
- Next Session: Run /session-start to begin work

## Project Origin
- Created: [First commit date]
- Scaffolding: [Detected - create-next-app, manual, etc.]
- ROK Init: [Today's date]
```

#### 3.3 Create init.sh (if missing)

```bash
#!/bin/bash
# Auto-generated by /project-init

echo "Starting [project-name]..."

# Detect and use appropriate start command
if [ -f "package.json" ]; then
    PORT=[detected-port] npm run dev
elif [ -f "requirements.txt" ]; then
    source venv/bin/activate 2>/dev/null
    uvicorn app.main:app --reload --port [port]
elif [ -f "Cargo.toml" ]; then
    cargo run
else
    echo "No recognized project type. Add start command manually."
fi
```

#### 3.4 Create feature_list.json (if missing)

```json
{
  "project": "[project-name]",
  "created": "[today]",
  "initialized_by": "/project-init",
  "features": [
    {
      "id": "rok-init",
      "category": "infrastructure",
      "description": "ROK infrastructure initialized",
      "status": "done",
      "session_completed": "[today]"
    }
  ],
  "notes": "Add features via /generate-feature-list or manually"
}
```

### Phase 4: ROK Brain Integration

#### 4.1 Create expertise file placeholder

```bash
# Create expertise file if it doesn't exist
EXPERTISE_FILE=~/.claude/expertise/$(basename $PWD).md

if [ ! -f "$EXPERTISE_FILE" ]; then
    cat > "$EXPERTISE_FILE" << 'EOF'
# [Project Name] Expertise

**Project**: [name]
**Type**: [detected]
**Initialized**: [today]

## Overview
[Brief description]

## Tech Stack
[Detected stack]

## Key Patterns
*Patterns will be captured via `/diary` during development.*

## Gotchas
*Gotchas will be captured via `/diary` during development.*

---
*Auto-generated by `/project-init`. Update via `/diary` and `/reflect`.*
EOF
fi
```

#### 4.2 Create ROK Brain project mirror

```bash
ROK_BRAIN=~/obsidian-vaults/rok-brain
PROJECT_NAME=$(basename $PWD)
PROJECT_DIR="$ROK_BRAIN/01-projects/$PROJECT_NAME"

# Create project directory in ROK Brain if missing
mkdir -p "$PROJECT_DIR"

# Create decisions.md if missing
if [ ! -f "$PROJECT_DIR/decisions.md" ]; then
    cat > "$PROJECT_DIR/decisions.md" << EOF
---
project: $PROJECT_NAME
created: $(date +%Y-%m-%d)
---

# $PROJECT_NAME Architecture Decisions

## Decisions

*Capture architecture decisions during development using \`/diary\` in ROK Copilot.*

## Related
- [[expertise]] - Project expertise (symlinked from ROK Copilot when available)
- [[02-knowledge/patterns/]] - Cross-project patterns
EOF
fi

# Create expertise symlink if expertise file exists
if [ -f "$EXPERTISE_FILE" ] && [ ! -L "$PROJECT_DIR/expertise.md" ]; then
    ln -sf "$EXPERTISE_FILE" "$PROJECT_DIR/expertise.md"
fi
```

### Phase 5: Verification & Report

Output summary to user:

```
╔═══════════════════════════════════════════════════════════════════╗
║                    PROJECT INITIALIZATION COMPLETE                 ║
╠═══════════════════════════════════════════════════════════════════╣
║  Project: [name]                                                   ║
║  Location: [path]                                                  ║
║  Type: [Next.js / FastAPI / Static / etc.]                         ║
╠═══════════════════════════════════════════════════════════════════╣
║  FILES CREATED                                                     ║
║  ─────────────                                                     ║
║  ✓ CLAUDE.md              - Project context                        ║
║  ✓ claude-progress.txt    - Session handoff log                    ║
║  ✓ init.sh                - Environment startup                    ║
║  ✓ feature_list.json      - Structured requirements                ║
╠═══════════════════════════════════════════════════════════════════╣
║  ROK BRAIN INTEGRATION                                             ║
║  ─────────────────────                                             ║
║  ✓ ~/.claude/expertise/[project].md - Expertise file               ║
║  ✓ rok-brain/01-projects/[project]/ - Project mirror               ║
║  ✓ decisions.md           - Architecture decisions                 ║
║  ✓ expertise.md           - Symlink to expertise file              ║
╠═══════════════════════════════════════════════════════════════════╣
║  NEXT STEPS                                                        ║
║  ──────────                                                        ║
║  1. Review generated CLAUDE.md and adjust as needed                ║
║  2. Run /session-start to begin development                        ║
║  3. Use /diary to capture learnings during work                    ║
║  4. Use /session-end when finishing                                ║
╚═══════════════════════════════════════════════════════════════════╝
```

## When to Run This Command

### MUST Run
- First CC session on any project
- After cloning a repo that doesn't have ROK files
- After Claude Desktop hands off a PRD to CC
- When `/session-start` reports missing files

### Auto-Detection (Future Enhancement)
Consider adding to `/session-start`:
```
if [ ! -f "CLAUDE.md" ]; then
    echo "⚠️  ROK infrastructure missing. Run /project-init first."
    exit 1
fi
```

## Files Created

| File | Location | Purpose |
|------|----------|---------|
| `CLAUDE.md` | Project root | Project context for CC |
| `claude-progress.txt` | Project root | Session handoff log |
| `init.sh` | Project root | Environment startup |
| `feature_list.json` | Project root | Structured requirements |
| `[project].md` | `~/.claude/expertise/` | Project expertise |
| `decisions.md` | ROK Brain project mirror | Architecture decisions |
| `expertise.md` | ROK Brain project mirror | Symlink to expertise |

## Integration with ROK Workflow

```
┌─────────────────────────────────────────────────────────────────┐
│                     PROJECT LIFECYCLE                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  Claude Desktop PRD  ───┐                                        │
│  create-next-app     ───┼──► /project-init ──► /session-start    │
│  git clone           ───┘         │                   │          │
│                                   │                   ▼          │
│                                   │              Development     │
│                                   │                   │          │
│                                   ▼                   ▼          │
│                           ROK Brain Mirror      /diary captures  │
│                           - decisions.md        - learnings      │
│                           - expertise.md        - patterns       │
│                                   │                   │          │
│                                   └───────┬───────────┘          │
│                                           ▼                      │
│                                    /session-end                  │
│                                           │                      │
│                                           ▼                      │
│                                    /reflect (periodic)           │
│                                    - synthesizes learnings       │
│                                    - updates CLAUDE.md           │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## Why This Matters

**Problem**: Claude Desktop creates PRDs and initializes projects, but CC sessions don't know to create ROK infrastructure. Projects end up with ad-hoc status files instead of standardized ones.

**Evidence**: 4 projects (bizcopilot, inventorycopilot, prism-dmv, seller-metrics) were missing CLAUDE.md despite being CC-exclusive projects.

**Solution**: `/project-init` ensures EVERY project has ROK infrastructure, regardless of origin.

---

**Project Init Command v1.0** | ROK 3.8
*Created: 2026-01-27 - Addresses missing CLAUDE.md issue*
